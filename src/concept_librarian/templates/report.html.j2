<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        .tab { display: none; }
        .tab.active { display: block; }
        .tab-button { padding: 10px 20px; margin-right: 5px; cursor: pointer; }
        .tab-button.active { background: #007bff; color: white; }
        .issue { margin: 1em 0; padding: 0.5em; background: #f5f5f5; display: flex; justify-content: space-between; align-items: flex-start; }
        .issue-content { flex: 1; }
        .metadata { font-family: monospace; margin-left: 1em; }
        .shuffle-button { margin: 1em 0; padding: 10px 20px; background: #28a745; color: white; border: none; cursor: pointer; }
        .concept-link { color: black; text-decoration: underline dotted; }
        a[target='_blank']::after {content: 'â†—'; display: inline-block; font-size: 0.8em;}
        .fix-button { padding: 5px 10px; background: white; color: #000000; border: none; cursor: pointer; margin-left: 1em; white-space: nowrap; }
        #ten-things-button { background: #B55ABE; color: white; }
        #ten-things { display: none; }
        #ten-things.active { display: block; }
    </style>
    <script>
        function openTab(evt, tabName) {
            const tabs = document.getElementsByClassName('tab');
            for (let tab of tabs) { tab.classList.remove('active'); }
            const buttons = document.getElementsByClassName('tab-button');
            for (let button of buttons) { button.classList.remove('active'); }
            document.getElementById('ten-things').classList.remove('active');
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        function showTenThings() {
            const tabs = document.getElementsByClassName('tab');
            for (let tab of tabs) { tab.classList.remove('active'); }
            const buttons = document.getElementsByClassName('tab-button');
            for (let button of buttons) { button.classList.remove('active'); }
            const allIssues = Array.from(document.getElementsByClassName('issue'));
            const randomIssues = allIssues.sort(() => 0.5 - Math.random()).slice(0, 10);
            const tenThingsDiv = document.getElementById('ten-things');
            tenThingsDiv.innerHTML = '<h2>Ten Things to Work On</h2>';
            randomIssues.forEach(issue => {
                const clone = issue.cloneNode(true);
                tenThingsDiv.appendChild(clone);
            });
            tenThingsDiv.classList.add('active');
        }

        function shuffleIssues(tabName) {
            const tab = document.getElementById(tabName);
            const issues = tab.getElementsByClassName('issue');
            const issuesArr = Array.from(issues);
            const parent = issues[0].parentNode;
            for (let i = issuesArr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [issuesArr[i], issuesArr[j]] = [issuesArr[j], issuesArr[i]];
            }
            issuesArr.forEach(issue => parent.appendChild(issue));
        }
    </script>
</head>
<body>
    <h1>Concept Store Librarian Report ðŸ“˜</h1>
    <p>Total issues found: {{ total_issues }}</p>
    
    <div class='tab-buttons'>
        <button class='tab-button' id='ten-things-button' onclick='showTenThings()'>LUCKY DIP</button>
        {% for issue_type, count in type_counts.items() %}
        <button class='tab-button' onclick="openTab(event, '{{ issue_type }}')">{{ issue_type }} ({{ count }})</button>
        {% endfor %}
    </div>

    <div id='ten-things'></div>

    {% for issue_type, issues in issues_by_type.items() %}
    <div id='{{ issue_type }}' class='tab'>
        <h2>{{ issue_type }}</h2>
        <button class='shuffle-button' onclick="shuffleIssues('{{ issue_type }}')">Shuffle Issues</button>
        <div class='issues-container'>
            {% for issue in issues %}
            <div class='issue'>
                <div class='issue-content'>
                    <p>{{ issue.message | safe }}</p>
                    <pre class='metadata'>{{ issue.metadata }}</pre>
                </div>
                <div>
                    {% if issue.fix_concept %}
                    <a href="{{ issue.fix_concept.wikibase_url }}" target="_blank" class="fix-button">Fix this</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <script>
        document.getElementsByClassName('tab-button')[0].click();
    </script>
</body>
</html>
